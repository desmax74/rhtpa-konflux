# RHTPA Konflux

## Directory structure

- **components**: Contains all repositories we need to build the whole RHTPA product

## Development

Clone this repositoy and init the submodules:

```shell
git submodule init
git submodule update
```

## Helm Chart

### Test Chart generated by Konflux

- Identify the container image that corresponds to the Helm Chart Component in Konflux. For instance:

```shell
export IMAGE=quay.io/redhat-user-workloads/trusted-content-tenant/rhtpa-helm-konflux@sha256:8d00a415359dce5bbe6cbea23f62487397bceda271d2f3c42ed6ea477935b5ff
```

- Set the container image to a variable

```shell
podman cp $(podman create --name helm-download $IMAGE):/tmp/trustify-helm-charts . && podman rm helm-download
```

### Replicate Konflux Helm creation locally

The values used for the Helm Chart is stored at the file `.helm.env`

For being able to locally build the Helm Chart you can do:

```shell
podman build -t trustify-helm-charts --build-arg-file .helm.env -f Dockerfile.helm .
```

Then get the helm using:

```shell
podman cp $(podman create --name helm-download trustify-helm-charts):/tmp/trustify-helm-charts . && podman rm helm-download
```

You should see a directory `trustify-helm-charts` being created and contains the Helm Chart
